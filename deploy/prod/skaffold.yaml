apiVersion: skaffold/v2beta7
kind: Config
metadata:
    name: blockvisor-ui
build:
    tagPolicy:
        gitCommit: {}
    artifacts:
        - image: us-docker.pkg.dev/blockjoy-deployer/blockvisor-ui/blockvisor-ui-staging
          context: ./
          docker:
              buildArgs:
                  NEXT_PUBLIC_VERCEL_ENV: 'production'
                  NEXT_PUBLIC_SUPPORT_EMAIL: 'support@blockjoy.com'
                  NEXT_PUBLIC_API_URL: 'https://api.staging.blockjoy.com'
                  NEXT_PUBLIC_MQTT_URL: 'wss://mqtt.staging.blockjoy.com:8084/mqtt'
                  NEXT_PUBLIC_SHORT_SHA: '{{.SHORT_SHA}}'

        - image: us-docker.pkg.dev/blockjoy-deployer/blockvisor-ui/blockvisor-ui-prod
          context: ./
          docker:
              buildArgs:
                  NEXT_PUBLIC_VERCEL_ENV: 'production'
                  NEXT_PUBLIC_SUPPORT_EMAIL: 'support@blockjoy.com'
                  NEXT_PUBLIC_API_URL: 'https://api.prod.blockjoy.com'
                  NEXT_PUBLIC_MQTT_URL: 'wss://mqtt.prod.blockjoy.com:8084/mqtt'
                  NEXT_PUBLIC_SHORT_SHA: '{{.SHORT_SHA}}'
                  NEXT_PUBLIC_MIXPANEL_TOKEN: '12c47463bb293286f0c40ee2e293f89a'
                  NEXT_PUBLIC_MIXPANEL_PROJECT_URL: 'https://app.blockjoy.com/mp'
    local:
        push: true
        useDockerCLI: true
        concurrency: 0
profiles:
    - name: dev
      deploy:
          kustomize:
              paths:
                  - ../kubernetes/dev
    - name: staging
      deploy:
          kustomize:
              paths:
                  - ../kubernetes/staging
    - name: prod
      deploy:
          kustomize:
              paths:
                  - ../kubernetes/prod
